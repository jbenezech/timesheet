{"version":3,"sources":["app.js","blur-image.js","environment.js","main.js","components/top-bar.js","components/user-app-router.js","config/app-settings.js","services/accounting-service.js","services/db-service.js","services/http-service.js","services/log.js","services/session.js","services/sharding-service.js","lib/form/semantic-form-validation-renderer.js","pages/admin/admin-panel.js","pages/admin/admin-report.js","pages/admin/admin-reports.js","pages/admin/admin-router.js","pages/admin/planning.js","pages/admin/user-timesheet.js","pages/admin/users-timesheets.js","pages/timesheets/monthly-timesheet.js","pages/timesheets/planning-router.js","pages/timesheets/planning.js","pages/timesheets/timesheet-entry.js","pages/timesheets/timesheets-router.js","pages/timesheets/timesheets.js","pages/user/logged-redirect.js","pages/user/login.js","pages/user/password.js","pages/user/user-router.js","resources/confirmation/confirmation.js","resources/confirmation/delete-button.js","resources/confirmation/ui-confirmation.js","resources/dropdown/dropdown.js","resources/flash/flash-error-message.js","resources/flash/flash-message.js","resources/flash/flash-success-message.js","resources/flash/flash.js","resources/formats/array-join.js","resources/formats/date-format.js","resources/formats/email.js","resources/formats/limit-to-value.js","resources/formats/month-format.js","resources/formats/tel.js","resources/formats/truncate.js"],"names":["App","i18n","httpClient","activate","configure","config","useStandardConfiguration","withDefaults","credentials","headers","withInterceptor","request","response","responseError","console","log","Error","statusText","append","localStorage","getItem","configureRouter","router","title","addPipelineStep","userApp","route","name","moduleId","nav","auth","loggedIn","map","authRoute","redirect","BlurImageCustomAttribute","Element","element","valueChanged","newImage","complete","drawBlur","onload","mul_table","shg_table","BLUR_RADIUS","stackBlurCanvasRGBA","canvas","top_x","top_y","width","height","radius","isNaN","context","getContext","imageData","getImageData","e","pixels","data","x","y","i","p","yp","yi","yw","r_sum","g_sum","b_sum","a_sum","r_out_sum","g_out_sum","b_out_sum","a_out_sum","r_in_sum","g_in_sum","b_in_sum","a_in_sum","pr","pg","pb","pa","rbs","div","w4","widthMinus1","heightMinus1","radiusPlus1","sumFactor","stackStart","BlurStack","stack","next","stackEnd","stackIn","stackOut","mul_sum","shg_sum","r","g","b","a","putImageData","image","w","h","canvasContext","drawImage","debug","testing","remoteUrls","addAppender","setLevel","logLevel","aurelia","Promise","longStackTraces","warnings","use","standardConfiguration","developmentLogging","plugin","instance","i18next","options","load","lowerCaseLng","cleanCode","setup","resGetPath","lngs","fallbackLng","default_locale","ns","defaultNs","configureContainer","container","start","then","setRoot","http","registerInstance","registerHandler","get","TopBar","session","db","dialogService","ea","error","logout","hasUnsyncedUpdate","open","viewModel","model","tr","result","wasCancelled","clearData","removeDBs","invalidate","attached","me","subscribe","navigateToPlanning","navigate","wipeAll","wipeAllDBs","replicateAll","replicateAllDBs","isGranted","UserAppRouter","isStarted","timesheets","planning","adminPlanning","user","routes","settings","calendar_text","days","months","monthsShort","today","now","am","pm","AccountingService","rules","Map","retrieveRules","accountingRuleEndKey","undefined","view","row","rows","set","key","charges","value","provision_cp_brut","provision_cp_charges","prime_precarite_brut","net_payable","urssaf","provisionAccounts","salarySlip","has","doProvision","resolve","accounts","salary","mul","provisionCPBrut","netPayable","provisionCPCharges","provisionCP","add","precarite","primePrecariteBrut","primePrecariteCharges","provisionPrecarite","DBService","sharding","dbs","syncHandlers","lastUpdates","lastSyncs","liveReplicates","restoreCheckpoints","getDB","dbName","setupDB","skip_setup","replicate","from","getRemoteUrl","addUpdateCheckpoint","handler","sync","getSyncOptions","on","change","addSyncCheckpoint","direction","publish","err","handleSyncError","isLiveReplicate","atob","split","match","RegExp","replace","token","ajax","live","retry","status","removeDB","handleUpdateError","doc","upsert","_id","catch","cancel","delete","removeUpdateCheckpoint","removeSyncCheckpoint","destroy","promises","forEach","push","all","window","indexedDB","webkitGetDatabaseNames","onsuccess","event","Array","prototype","call","target","deleteDatabase","bind","removeItem","clear","promise","list","remove","_rev","listUsers","fetch","json","users","filter","id","localUser","originRev","roles","createOrReplaceLocalUser","filteredUsers","allDocs","include_docs","put","limit","descending","firstRequestOptions","Object","assign","secondRequestOptions","endkey","startkey","results","endResults","viewName","startKey","endKey","group","start_key","end_key","query","to","save","success","create","post","Date","persistMap","storage","setItem","JSON","stringify","parse","hasUnsynced","lastUpdate","HTTPService","withBaseUrl","baseUrl","FlashErrorMessage","authHeader","fakeAuthService","getAuthHeaderValue","url","getLogger","Session","loadFromStorage","locale","getLocale","setLocale","started","loadUserFromBackend","persistToStorage","setUser","getUser","userInfo","username","password","skipSetup","preferred_locale","switchLocale","setBaseUrl","history","fragment","getToken","role","includes","MAX_CONNECTIONS","ShardingService","curIndex","curConnections","length","SemanticFormValidationRenderer","boundaryElement","render","instruction","unrender","elements","valid","errors","field","querySelector","closest","classList","message","document","createElement","textContent","appendChild","messages","querySelectorAll","ELEMENT","matches","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","selector","parentElement","AdminPanel","$","tab","param","au","controller","refresh","params","month","AdminReport","AdminReports","accounting","taskQueue","allocations","allocationUserReports","allocationReports","showMonthAggregate","checkbox","onChange","hasClass","loadReports","subscriber","retrieveAllocationReports","queueMicroTask","generateUsersExportLinks","aggregateReports","detached","dispose","getNextMonth","monthArr","parseInt","retrieveUsers","retrieveAllocations","allocation","entries","reportsPromises","entry","report","allocationName","ratio","parseFloat","duration","groupReportsByAllocation","reports","totals","nbrReports","grouped","reportIdx","addReportsData","current","values","source","getOwnPropertyNames","prop","allReports","allocationUserReportObjects","generateExportLink","csvContent","fileName","lnk","getElementById","setAttribute","encodeURIComponent","AdminRouter","navigateToRoute","Planning","find","calendar","type","inline","text","date","timesheetId","format","UserTimesheet","of","userName","timesheet","ensure","required","withMessage","allocationSelected","dropdown","dataset","entryid","selectedEntry","calculateRatios","saveTimesheet","allocationAdded","each","totalHours","toJSON","validate","openEntry","UsersTimesheets","purposes","unallocatedOnly","retrieveData","retrieveTimesheets","retrievePurposes","purpose","MonthlyTimesheet","interprets","listPurposes","listInterprets","getTimesheet","interpret","entity","PlanningRouter","TimesheetEntry","routeConfig","navigationInstruction","entryId","getTimesheetEntry","redirectTo","queryParams","hours","minutes","interpret_hours","interpret_minutes","setDate","setupValidation","formatInput","customRule","obj","isMonthUnChanged","satisfiesRule","when","getMonth","getCalendarDate","doSave","isEditable","interpret_duration","slice","reverse","item","index","object","splice","saveAction","TimesheetsRouter","Timesheets","lastTimesheet","getLastTimesheet","accordion","exclusive","saveEntry","LoggedRedirect","Login","login","loginError","show","btoa","Password","form","current_password","plain_password","first","second","newrules","minimum","equality","addClass","method","body","removeClass","reject","UserRouter","Confirmation","dialogController","DeleteButton","rest","do","$event","stopPropagation","action","BaseViewModel","UIConfirmationAttribute","alert","modal","onApprove","confirmEvent","CustomEvent","detail","bubbles","dispatchEvent","activeChanged","newValue","$arg","approveCallback","DropDownCustomElement","allowAdd","$choice","selectedEntryChanged","isSelectedEntryNew","selected","setEntryName","selectAction","isNew","restoreDefaults","selectedEntryName","getPlaceHolder","multiple","newEntry","addAction","FlashMessage","FlashSuccessMessage","Flash","eventAggregator","cssAnimator","animator","messageElement","flashType","scrollTo","JoinValueConverter","toView","isArray","join","DateFormatValueConverter","EmailValueConverter","html","mail","LimitToValueConverter","array","count","MonthFormatValueConverter","TelValueConverter","tel","TruncateValueConverter","substring"],"mappings":"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","file":"app-bundle.js","sourcesContent":["import { HttpClient } from 'aurelia-fetch-client';\nimport { inject } from 'aurelia-framework';\nimport { I18N } from 'aurelia-i18n';\nimport { AuthorizeStep } from 'aurelia-auth';\n\n@inject(I18N, HttpClient)\nexport class App {\n\n    constructor(i18n, httpClient) {\n        this.i18n = i18n;\n        this.httpClient = httpClient;\n    }\n\n    activate() {\n    \n        let i18n = this.i18n;\n\n        this.httpClient.configure(config => {\n        config\n            .useStandardConfiguration()\n            .withDefaults({\n            credentials: 'same-origin',\n            headers: {\n                'Accept': 'application/json',\n                'X-Requested-With': 'Fetch'\n            }\n            })\n            .withInterceptor({\n                request(request) {\n                    return request;\n                },\n                response(response) {\n                    return response;\n                },\n                responseError(response) {\n                    console.log(response);\n                    return new Error(response.statusText);\n                }\n            })\n            .withInterceptor({\n                request(request) {\n                    request.headers.append('Authorization', 'Basic ' + localStorage.getItem('aurelia_token'));\n                    return request;\n                }\n            })\n            ;\n        });\n    }\n\n\n    configureRouter(config, router) {\n        config.title = 'Ruelle';\n\n        config.addPipelineStep('authorize', AuthorizeStep);\n        let userApp = {\n            route: ['app'], \n            name: 'home', \n            moduleId: 'components/user-app-router', \n            nav: false, \n            auth: true  \n        };\n\n        let loggedIn = {\n            route: ['loggedIn'], \n            name: 'Logged', \n            moduleId: 'pages/user/logged-redirect', \n            nav: false, \n            title: 'Logged',\n            auth: true  \n        };\n\n        config.map([\n            { route: ['login'], name: 'login', moduleId: 'pages/user/login', nav: false, title: 'Login', authRoute: true },\n            { route: '', redirect: 'loggedIn' },\n            ...userApp,\n            ...loggedIn\n        ]);\n\n        this.router = router;\n    }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class BlurImageCustomAttribute {\n  constructor(element) {\n    this.element = element;\n  }\n\n  valueChanged(newImage) {\n    if (newImage.complete) {\n      drawBlur(this.element, newImage);\n    } else {\n      newImage.onload = () => drawBlur(this.element, newImage);\n    }\n  }\n}\n\n/* eslint-disable */\n\n/*\nThis Snippet is using a modified Stack Blur js lib for blurring the header images.\n*/\n\n/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion:     0.5\nAuthor:\t\tMario Klingemann\nContact: \tmario@quasimondo.com\nWebsite:\thttp://www.quasimondo.com/StackBlurForCanvas\nTwitter:\t@quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nvar mul_table = [\n        512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,\n        454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,\n        482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,\n        437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,\n        497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,\n        320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,\n        446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,\n        329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,\n        505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,\n        399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,\n        324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,\n        268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,\n        451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,\n        385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,\n        332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,\n        289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];\n\n\nvar shg_table = [\n\t     9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17,\n\t\t17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19,\n\t\t19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,\n\t\t20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24 ];\n\nvar BLUR_RADIUS = 40;\n\nfunction stackBlurCanvasRGBA( canvas, top_x, top_y, width, height, radius )\n{\n\tif ( isNaN(radius) || radius < 1 ) return;\n\tradius |= 0;\n\n\tvar context = canvas.getContext(\"2d\");\n\tvar imageData;\n\n\ttry {\n\t  imageData = context.getImageData( top_x, top_y, width, height );\n\t} catch(e) {\n\t  throw new Error(\"unable to access image data: \" + e);\n\t}\n\n\tvar pixels = imageData.data;\n\n\tvar x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum, a_sum,\n\tr_out_sum, g_out_sum, b_out_sum, a_out_sum,\n\tr_in_sum, g_in_sum, b_in_sum, a_in_sum,\n\tpr, pg, pb, pa, rbs;\n\n\tvar div = radius + radius + 1;\n\tvar w4 = width << 2;\n\tvar widthMinus1  = width - 1;\n\tvar heightMinus1 = height - 1;\n\tvar radiusPlus1  = radius + 1;\n\tvar sumFactor = radiusPlus1 * ( radiusPlus1 + 1 ) / 2;\n\n\tvar stackStart = new BlurStack();\n\tvar stack = stackStart;\n\tfor ( i = 1; i < div; i++ )\n\t{\n\t\tstack = stack.next = new BlurStack();\n\t\tif ( i == radiusPlus1 ) var stackEnd = stack;\n\t}\n\tstack.next = stackStart;\n\tvar stackIn = null;\n\tvar stackOut = null;\n\n\tyw = yi = 0;\n\n\tvar mul_sum = mul_table[radius];\n\tvar shg_sum = shg_table[radius];\n\n\tfor ( y = 0; y < height; y++ )\n\t{\n\t\tr_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;\n\n\t\tr_out_sum = radiusPlus1 * ( pr = pixels[yi] );\n\t\tg_out_sum = radiusPlus1 * ( pg = pixels[yi+1] );\n\t\tb_out_sum = radiusPlus1 * ( pb = pixels[yi+2] );\n\t\ta_out_sum = radiusPlus1 * ( pa = pixels[yi+3] );\n\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\t\ta_sum += sumFactor * pa;\n\n\t\tstack = stackStart;\n\n\t\tfor( i = 0; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack.a = pa;\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\tfor( i = 1; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tp = yi + (( widthMinus1 < i ? widthMinus1 : i ) << 2 );\n\t\t\tr_sum += ( stack.r = ( pr = pixels[p])) * ( rbs = radiusPlus1 - i );\n\t\t\tg_sum += ( stack.g = ( pg = pixels[p+1])) * rbs;\n\t\t\tb_sum += ( stack.b = ( pb = pixels[p+2])) * rbs;\n\t\t\ta_sum += ( stack.a = ( pa = pixels[p+3])) * rbs;\n\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\t\t\ta_in_sum += pa;\n\n\t\t\tstack = stack.next;\n\t\t}\n\n\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor ( x = 0; x < width; x++ )\n\t\t{\n\t\t\tpixels[yi+3] = pa = (a_sum * mul_sum) >> shg_sum;\n\t\t\tif ( pa != 0 )\n\t\t\t{\n\t\t\t\tpa = 255 / pa;\n\t\t\t\tpixels[yi]   = ((r_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t\tpixels[yi+1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t\tpixels[yi+2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t} else {\n\t\t\t\tpixels[yi] = pixels[yi+1] = pixels[yi+2] = 0;\n\t\t\t}\n\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\t\t\ta_sum -= a_out_sum;\n\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\t\t\ta_out_sum -= stackIn.a;\n\n\t\t\tp =  ( yw + ( ( p = x + radius + 1 ) < widthMinus1 ? p : widthMinus1 ) ) << 2;\n\n\t\t\tr_in_sum += ( stackIn.r = pixels[p]);\n\t\t\tg_in_sum += ( stackIn.g = pixels[p+1]);\n\t\t\tb_in_sum += ( stackIn.b = pixels[p+2]);\n\t\t\ta_in_sum += ( stackIn.a = pixels[p+3]);\n\n\t\t\tr_sum += r_in_sum;\n\t\t\tg_sum += g_in_sum;\n\t\t\tb_sum += b_in_sum;\n\t\t\ta_sum += a_in_sum;\n\n\t\t\tstackIn = stackIn.next;\n\n\t\t\tr_out_sum += ( pr = stackOut.r );\n\t\t\tg_out_sum += ( pg = stackOut.g );\n\t\t\tb_out_sum += ( pb = stackOut.b );\n\t\t\ta_out_sum += ( pa = stackOut.a );\n\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\t\t\ta_in_sum -= pa;\n\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += 4;\n\t\t}\n\t\tyw += width;\n\t}\n\n\n\tfor ( x = 0; x < width; x++ )\n\t{\n\t\tg_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;\n\n\t\tyi = x << 2;\n\t\tr_out_sum = radiusPlus1 * ( pr = pixels[yi]);\n\t\tg_out_sum = radiusPlus1 * ( pg = pixels[yi+1]);\n\t\tb_out_sum = radiusPlus1 * ( pb = pixels[yi+2]);\n\t\ta_out_sum = radiusPlus1 * ( pa = pixels[yi+3]);\n\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\t\ta_sum += sumFactor * pa;\n\n\t\tstack = stackStart;\n\n\t\tfor( i = 0; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack.a = pa;\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\typ = width;\n\n\t\tfor( i = 1; i <= radius; i++ )\n\t\t{\n\t\t\tyi = ( yp + x ) << 2;\n\n\t\t\tr_sum += ( stack.r = ( pr = pixels[yi])) * ( rbs = radiusPlus1 - i );\n\t\t\tg_sum += ( stack.g = ( pg = pixels[yi+1])) * rbs;\n\t\t\tb_sum += ( stack.b = ( pb = pixels[yi+2])) * rbs;\n\t\t\ta_sum += ( stack.a = ( pa = pixels[yi+3])) * rbs;\n\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\t\t\ta_in_sum += pa;\n\n\t\t\tstack = stack.next;\n\n\t\t\tif( i < heightMinus1 )\n\t\t\t{\n\t\t\t\typ += width;\n\t\t\t}\n\t\t}\n\n\t\tyi = x;\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor ( y = 0; y < height; y++ )\n\t\t{\n\t\t\tp = yi << 2;\n\t\t\tpixels[p+3] = pa = (a_sum * mul_sum) >> shg_sum;\n\t\t\tif ( pa > 0 )\n\t\t\t{\n\t\t\t\tpa = 255 / pa;\n\t\t\t\tpixels[p]   = ((r_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t\tpixels[p+1] = ((g_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t\tpixels[p+2] = ((b_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t} else {\n\t\t\t\tpixels[p] = pixels[p+1] = pixels[p+2] = 0;\n\t\t\t}\n\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\t\t\ta_sum -= a_out_sum;\n\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\t\t\ta_out_sum -= stackIn.a;\n\n\t\t\tp = ( x + (( ( p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1 ) * width )) << 2;\n\n\t\t\tr_sum += ( r_in_sum += ( stackIn.r = pixels[p]));\n\t\t\tg_sum += ( g_in_sum += ( stackIn.g = pixels[p+1]));\n\t\t\tb_sum += ( b_in_sum += ( stackIn.b = pixels[p+2]));\n\t\t\ta_sum += ( a_in_sum += ( stackIn.a = pixels[p+3]));\n\n\t\t\tstackIn = stackIn.next;\n\n\t\t\tr_out_sum += ( pr = stackOut.r );\n\t\t\tg_out_sum += ( pg = stackOut.g );\n\t\t\tb_out_sum += ( pb = stackOut.b );\n\t\t\ta_out_sum += ( pa = stackOut.a );\n\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\t\t\ta_in_sum -= pa;\n\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += width;\n\t\t}\n\t}\n\n\tcontext.putImageData( imageData, top_x, top_y );\n\n}\n\nfunction BlurStack()\n{\n\tthis.r = 0;\n\tthis.g = 0;\n\tthis.b = 0;\n\tthis.a = 0;\n\tthis.next = null;\n}\n\nfunction drawBlur(canvas, image) {\n  var w = canvas.width;\n  var h = canvas.height;\n  var canvasContext = canvas.getContext('2d');\n  canvasContext.drawImage(image, 0, 0, w, h);\n  stackBlurCanvasRGBA(canvas, 0, 0, w, h, BLUR_RADIUS);\n};\n","export default {\n  debug: true,\n  testing: true,\n  remoteUrls: [\n    'https://proacti.cloudant.com/'\n  ]\n};\n","import { HttpClient } from 'aurelia-fetch-client';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { I18N } from 'aurelia-i18n';\nimport Backend from 'i18next-xhr-backend';\nimport semanticui from 'semantic';\nimport semanticuicalendar from 'semantic-calendar/calendar';\nimport { LogManager } from 'aurelia-framework';\nimport { ConsoleAppender } from 'aurelia-logging-console';\n\nimport { SemanticFormValidationRenderer } from 'lib/form/semantic-form-validation-renderer';\nimport settings from './config/app-settings';\n\nLogManager.addAppender(new ConsoleAppender());\nLogManager.setLevel(LogManager.logLevel.debug);\n\nexport function configure(aurelia) {\n\n    //disable warnings from bluebird poluting the console\n    //https://github.com/aurelia/skeleton-navigation/issues/282\n    //https://www.jujens.eu/posts/en/2016/Aug/17/switch-to-aurelia-cli/\n    Promise.config({\n        longStackTraces: false,\n        warnings: false,\n    });\n\n    aurelia.use\n    .standardConfiguration()\n    .developmentLogging()\n\n    .plugin(\"aurelia-dialog\")\n    .plugin('aurelia-validation')\n    .plugin('aurelia-i18n', (instance) => {\n        \n        instance.i18next.use(Backend);\n\n        //below settings needed to support en-US locales (with - in name)\n        instance.i18next.options.load = 'currentOnly';\n        instance.i18next.options.lowerCaseLng = false;\n        instance.i18next.options.cleanCode = false;\n\n        return instance.setup({\n            resGetPath : 'locales/__lng__/__ns__.json',\n            lngs: ['fr-FR'],\n            fallbackLng : settings.default_locale,\n            debug: settings.debug,\n            ns: ['translation'],\n            defaultNs: 'translation'\n        });\n    })\n    ;\n\n    configureContainer(aurelia.container);\n\n    aurelia.start().then(() => {\n        aurelia.setRoot()\n    });\n}\n\n\nfunction configureContainer(container) {\n    let http = new HttpClient();\n    \n    container.registerInstance(HttpClient, http);\n    //container.registerInstance(HttpClient, httpMock);\n\n    container.registerHandler(\n        'semantic-form',\n        container => container.get(SemanticFormValidationRenderer));  \n}\n","import { inject } from 'aurelia-framework';\nimport { I18N } from 'aurelia-i18n';\nimport { DialogService } from \"aurelia-dialog\";\nimport { EventAggregator } from 'aurelia-event-aggregator';\n\nimport { Confirmation } from \"../resources/confirmation/confirmation\";\nimport { DBService } from '../services/db-service';\nimport { Session } from '../services/session';\nimport settings from '../config/app-settings';\nimport environment from '../environment';\nimport { log } from '../services/log';\n\n@inject(Session, I18N, DBService, DialogService, EventAggregator)\nexport class TopBar {\n\n    //marker to show erros alarm\n    error = false;\n    \n    constructor(session, i18n, db, dialogService, ea) {    \n        this.session = session;   \n        this.i18n = i18n;\n        this.db = db;\n        this.dialogService = dialogService;\n        this.ea = ea;\n    }\n\n    get isTest() {\n        return environment.testing;\n    }\n\n    get isAdmin() {\n        return this.session.isGranted('admin');\n    }\n    \n    get isSynced() {\n        return !this.db.hasUnsyncedUpdate();\n    }\n\n    logout() {\n        //When logging out, first check if there are updates not synced with remote yet\n        //if so, ask confirmation as these will be lost\n        if (this.db.hasUnsyncedUpdate()) {\n            this.dialogService.open({\n                viewModel: Confirmation,\n                model: this.i18n.tr('unsync-warning')\n            }).then(result => {\n                if (result.wasCancelled) return;\n                this.clearData();\n            });\n            return;\n        }\n        \n        this.clearData();\n    }\n\n    clearData() {\n        this.db.removeDBs().then( () => this.session.invalidate() );\n    }\n\n    attached() {\n        let me = this;\n        this.ea.subscribe('dberr', response => {\n            log.error(response);\n            this.error = true;\n        });\n    }\n\n    navigateToPlanning() {\n        this.navigate('app/timesheets/planning');\n    }\n\n    //used for testing, clears all documents in all databases\n    wipeAll() {\n        this.db.wipeAllDBs();\n    }\n\n    //used for testing, force replication of all documents in all databases\n    replicateAll() {\n        this.db.replicateAllDBs();\n    }\n\n}\n","import { inject } from 'aurelia-framework';\nimport { I18N } from 'aurelia-i18n';\nimport { Session } from '../services/session';\nimport settings from '../config/app-settings';\n\n@inject(Session, I18N)\n\n/**\n * Router for the App once the user is logged in\n */\nexport class UserAppRouter {\n\n    constructor(session, i18n) {    \n        this.session = session;\n        this.i18n = i18n;\n\n        if (!this.session.isStarted()) {\n            this.session.start();\n        }\n\n    }\n\n    configureRouter(config, router) {\n\n        let timesheets = { \n            route: ['timesheets'], \n            name: 'timesheets', \n            moduleId: 'pages/timesheets/timesheets-router', \n            nav: true, \n            auth: true\n        };\n\n        let planning = { \n            route: ['planning'], \n            name: 'planning', \n            moduleId: 'pages/timesheets/planning-router', \n            nav: true, \n            auth: true\n        };\n\n        let adminPlanning = { \n            route: ['admin'], \n            name: 'admin-planning', \n            moduleId: 'pages/admin/admin-router', \n            nav: true, \n            auth: true\n        };\n\n        let user = { \n            route: ['user'], \n            name: 'user', \n            moduleId: 'pages/user/user-router', \n            nav: false, \n            auth: true\n        };\n\n        let error = { \n            route: ['user'], \n            name: 'user', \n            moduleId: 'pages/user/user-router', \n            nav: false, \n            auth: true\n        };\n\n        let routes = [\n            timesheets,\n            planning,\n            adminPlanning,\n            user,\n            error\n        ];\n\n        config.map(routes);\n\n        this.router = router;\n\n    }\n\n}","import environment from '../environment'\n\nvar settings = {\n    remoteUrls: environment.remoteUrls,\n    default_locale: 'fr-FR',\n    debug: true,\n\n    calendar_text: {\n        days: ['S', 'M', 'T', 'W', 'T', 'F', 'S'],\n        months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n        monthsShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n        today: 'Today',\n        now: 'Now',\n        am: 'AM',\n        pm: 'PM'\n    }\n}\n\n\nexport default settings;","import { inject, singleton } from 'aurelia-framework';\nimport PouchDB from 'pouchdb';\nimport moment from 'moment';\nimport Decimal from 'decimal';\n\nimport { log } from './log';\nimport { DBService } from './db-service';\n\n@inject(DBService)\n@singleton()\n\n/**\n * Service to retrieve accounting rules from remote and calculate\n * the different accounting entries for a salary slip\n */\nexport class AccountingService {\n\n    rules = new Map();\n\n    constructor(db) {\n        this.db = db;\n    }\n\n    retrieveRules(accountingRuleEndKey) {\n\n        if (accountingRuleEndKey === undefined) {\n            return;\n        }\n\n        return this.db.view('accounting', 'accounting/rules', accountingRuleEndKey, '', false, true, 1)\n        .then( rows => {\n\n            let row = rows[0];\n            this.rules.set(\n                row.key,\n                {\n                    charges: new Decimal(row.value[0]),\n                    provision_cp_brut: new Decimal(row.value[1]),\n                    provision_cp_charges: new Decimal(row.value[2]),\n                    prime_precarite_brut: new Decimal(row.value[3]),\n                    net_payable: new Decimal(row.value[4]),\n                    urssaf: new Decimal(row.value[5])\n                }\n            );\n\n        });\n\n    }\n\n    provisionAccounts(accountingRuleEndKey, salarySlip) {\n\n        let me = this;\n        if (!this.rules.has(accountingRuleEndKey)) {\n            return this.retrieveRules(accountingRuleEndKey).then( () => {\n                return me.doProvision(me.rules.get(accountingRuleEndKey), salarySlip);\n            });\n        }\n\n        return new Promise( (resolve) => resolve(me.doProvision(me.rules.get(accountingRuleEndKey), salarySlip)) );\n    }\n\n    doProvision(rules, salarySlip) {    \n        \n        let accounts = {\n            salary: salarySlip.salary,\n            charges: salarySlip.salary.mul(rules.charges),\n            provisionCPBrut: salarySlip.salary.mul(rules.provision_cp_brut),\n            netPayable: salarySlip.salary.mul(rules.net_payable),\n            urssaf: salarySlip.salary.mul(rules.urssaf)\n        };\n\n        accounts.provisionCPCharges = accounts.charges.mul(rules.provision_cp_charges);\n        accounts.provisionCP = accounts.provisionCPBrut.add(accounts.provisionCPCharges);\n\n        if (salarySlip.precarite) {\n            accounts.primePrecariteBrut = salarySlip.salary.mul(rules.prime_precarite_brut);\n            accounts.primePrecariteCharges = accounts.primePrecariteBrut.mul(rules.provision_cp_charges);\n            accounts.provisionPrecarite = accounts.primePrecariteBrut.add(accounts.primePrecariteCharges);\n        } else {\n            accounts.primePrecariteBrut = new Decimal(0);\n            accounts.primePrecariteCharges = new Decimal(0);\n            accounts.provisionPrecarite = new Decimal(0);        \n        }\n\n        salarySlip.accounts = accounts;\n\n        return salarySlip;\n    }\n\n}","import { inject, singleton } from 'aurelia-framework';\nimport { Session} from './session';\nimport PouchDB from 'pouchdb';\nimport PouchdbUpsert from 'pouchdb-upsert';\nimport moment from 'moment';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { HttpClient } from 'aurelia-fetch-client';\nimport { log } from './log';\nimport settings from '../config/app-settings';\nimport { ShardingService } from './sharding-service';\nimport environment from '../environment';\n\n@inject(Session, ShardingService, HttpClient, EventAggregator)\n@singleton()\nexport class DBService {\n\n    //dbs currently connected and their sync handlers\n    dbs = new Map();\n    syncHandlers = new Map();\n    \n    //moments when dbs get updated and synced to remote\n    lastUpdates = new Map();\n    lastSyncs = new Map();\n\n    //array if database patterns that are synced live with remote\n    liveReplicates = [\n        '^accounting$',\n        '^interpret$',\n        '^purpose$',\n        '^timesheet\\-{0}$'\n    ];\n\n    constructor(session, sharding, http, ea) {\n        this.session = session;\n        this.sharding = sharding;\n        this.http = http;\n        this.ea = ea;\n\n        this.restoreCheckpoints();\n\n        PouchDB.plugin(PouchdbUpsert);\n    }\n\n    //returns the db instance created for a name\n    getDB(dbName) {\n\n        if (!this.dbs.has(dbName)) {\n            return this.setupDB(dbName)\n            .then( (db) => {\n                this.dbs.set(dbName, db);\n                return db;\n            });\n        }\n\n        return new Promise( (resolve) => resolve(this.dbs.get(dbName)) );\n\n    } \n\n    //sets the database up with eventual sync to remote\n    setupDB(dbName) {\n\n        let me = this;\n\n        let db = new PouchDB(dbName,{skip_setup: true});\n        \n        //don't sync live with remote in testing environment\n        //but retrieve remote docs\n        if (environment.testing) {\n            return db.replicate.from(this.sharding.getRemoteUrl() + dbName)\n            .then( () => {\n                return db;\n            } );\n        }\n        \n        this.addUpdateCheckpoint(dbName);\n\n        let handler = db.sync(\n            this.sharding.getRemoteUrl() + dbName, \n            me.getSyncOptions(dbName)\n        ).on('change', function (change) {\n\n            me.addSyncCheckpoint(dbName);\n\n            //notify the application that data may have changed\n            if (change.direction === 'pull') {\n                me.ea.publish('dbsync', {dbName: dbName});\n            }\n\n        }).on('paused', function (err) {\n            //paused if no more data to sync or disconnected\n            //add sync marker although it's possible some new local data was not \n            //yet synced with remote if disconnected.\n            //Need to find a better way to handle this\n            // 1. User enters new data\n            // 2. User disconnects before new data is synced\n            // -> marker set as synced\n            //probably need different marker for incoming and outgoing syncs\n            me.addSyncCheckpoint(dbName);\n        }).on('error', function (err) {\n            me.handleSyncError(db, err);\n        });\n\n        this.syncHandlers.set(dbName, handler);\n\n        return new Promise( (resolve) => resolve(db) );\n\n    }\n\n    //returns true if the database has been setup with remote sync\n    isLiveReplicate(dbName) {\n\n        let user = atob(localStorage.getItem('aurelia_token')).split(':')[0];\n        for (let db of this.liveReplicates) {\n            if (dbName.match(new RegExp(db.replace('{0}', user)))) {\n                return true;\n            }\n        }\n        return false;\n\n    }\n\n    //returns the sync options for a database\n    getSyncOptions(dbName) {\n        //We can't use live replication with all databases as browsers have a limit\n        //on the number of active connections per host.\n        //The shrading service does not work over https for cloudant\n        //So for now, only replicate live restricted databases\n        let token = localStorage.getItem('aurelia_token');\n        let options = {\n            ajax: {\n                \"headers\": {\n                    \"Authorization\": \"Basic \" + token\n                }\n            }\n        }\n\n        if (this.isLiveReplicate(dbName)) {\n            options.live = true;\n            options.retry = true;\n        }\n        \n        return options;\n    }\n\n    //handles sync errors, publishing an event eventually\n    handleSyncError(db, err) {\n        //destroy local database if permission has been revoked or remote database has been deleted\n        if (err.status === 403 || err.status === 404) {\n            this.removeDB(db);\n        } else if (err.status === 401) {\n            //unauthorized, user has been revoked or password changed. Remove local storage\n            this.session.invalidate();\n        } else if (err.result !== undefined && err.result.status === 'cancelled') {\n            //seems to happen when removing the databases while they are syncing\n            log.error(err);            \n        } else {\n            //Not sure what error this is but we need to report it\n            this.ea.publish('dberr', {dbName: db.name, err: err});\n        }\n    }\n\n    //handles update errors, publishing an error eventually\n    handleUpdateError(db, doc, err) {\n\n        //only handling immediate conflicts by retrying\n        //let pouchdb handle evantual conflicts\n        if (err.status === 409 && err.name === 'conflict') {\n            //immediate conflict\n            db.upsert(doc._id, () => {                \n                return doc; \n            }).catch( err => {\n                log.error(err);\n                this.ea.publish('dberr', {dbName: db.name, doc: doc, err: err});\n            });\n        }\n    }\n\n    //remove the database from storage and memory. Clears sync points\n    removeDB(db) {\n        if (this.syncHandlers.has(db.name)) {\n            this.syncHandlers.get(db.name).cancel();\n            this.syncHandlers.delete(db.name);\n        }\n        this.dbs.delete(db.name);\n        this.removeUpdateCheckpoint(db.name);\n        this.removeSyncCheckpoint(db.name);\n        return db.destroy();\n    }\n\n    //removes all databases\n    removeDBs() {\n        let me = this;\n        let promises = [];\n        //stop replication on all databases\n        this.dbs.forEach(function (db, dbName) {\n            promises.push(me.removeDB(db));\n        });\n\n        return Promise.all(promises)\n        .then( () => {\n\n            //remove all indexdb databases (some might be there but no mounted in memory)\n            //https://gist.github.com/rmehner/b9a41d9f659c9b1c3340\n            window.indexedDB.webkitGetDatabaseNames().onsuccess = function(event) {\n                Array.prototype.forEach.call(event.target.result, indexedDB.deleteDatabase.bind(indexedDB));\n            }\n\n            //also remove sync markers\n            localStorage.removeItem('last-updates');\n            localStorage.removeItem('last-syncs');\n            this.lastUpdates.clear();\n            this.lastSyncs.clear();\n            return new Promise( (resolve) => resolve() );\n        });\n\n    }\n\n    //deleted all documents in local database and disconnect from remote\n    wipeAllDBs() {\n\n        let me = this;\n        let promises = [];\n        //destroy the database and set it up again without replication\n        this.dbs.forEach(function (db, dbName) {\n            let promise = me.list(dbName)\n            .then( (rows) => {\n                return rows.map( (row) => {\n                    db.remove(row.doc._id, row.doc._rev);\n                });\n            });\n            promises.push(promise);\n        });\n        \n        return Promise.all(promises)\n\n    }\n\n    //list all application users\n    listUsers() {\n\n        //we cannot replicate the _users database even with admin access to it\n        //so we copy it partially if we can retrieve it\n        if (!this.dbs.has('staff')) {\n            let db = new PouchDB('staff', {skip_setup: true});\n            this.dbs.set('staff', db);\n        } \n\n        let db = this.dbs.get('staff');\n\n        let me = this;\n        let promises = [];\n\n        //we can't access design documents on _users database so we retrieve all docs        \n        return this.http.fetch(this.sharding.getRemoteUrl() + '_users/_all_docs?include_docs=true')\n        .then(response => response.json())\n        .then(users => {\n\n            return Promise.all(\n                users.rows.filter( (user) => {\n                    return user.id.match(/^org\\.couchdb\\.user/);\n                }).map( (user) => {\n\n                    let localUser = {\n                        id: user.doc._id,\n                        doc: {\n                            _id: user.doc._id,\n                            name: user.doc.name,\n                            originRev: user.doc._rev,\n                            roles: user.doc.roles\n                        }\n                    }\n\n                    return this.createOrReplaceLocalUser(localUser);\n\n                })\n            );\n\n        }).then( (filteredUsers) => {\n            return filteredUsers;\n        }).catch( err => {\n            //if we cannot connect to remote, retrieve local staff database\n            return db.allDocs({include_docs: true})\n            .then( (result) => result.rows)\n            .catch ( err => { log.error(err); return []; });\n        })\n\n    }\n\n    //creates a local user if it doe not exist, replace it if it does\n    createOrReplaceLocalUser(user) {\n\n        let db = this.dbs.get('staff');\n\n        let me = this;\n        //replace existing doc if it exists or create it if not\n        return db.get(user.id)\n        .then( (doc) => {\n            \n            if (doc.originRev === user.doc.originRev) {\n                return new Promise( (resolve) => resolve(user) );\n            }\n\n            user.doc._rev = doc._rev;\n            return db.put(user.doc)\n            .then ( () => user )\n            .catch(err => {\n                return me.handleUpdateError(db, user.doc, err);\n            });\n        }).then( (r) => {\n            return user;                    \n        }).catch( (err) => {\n            if (err.status === 404) {\n                return db.put(user.doc)\n                .then( () => {\n                    return user;\n                }).catch(err => {\n                    me.handleUpdateError(db, user.doc, err);\n                    return user;\n                });\n            }\n        });\n\n    }\n\n    //list docs in a database\n    list(dbName, limit = false, descending = false) {\n\n        let options = {\n            include_docs: true\n        }\n        if (limit) {\n            options.limit = limit;\n        }\n        if (descending) {\n            options.descending = descending;\n        }\n\n        //To exclude design docs when listing documents, we need 2 separate requests\n        //https://issues.apache.org/jira/browse/COUCHDB-2227\n\n        //if descending, get the last docs first. Otherwise start with alpha order\n        let firstRequestOptions = Object.assign({}, options);\n        let secondRequestOptions = Object.assign({}, options);\n\n        if (descending) {\n            firstRequestOptions.endkey = '_design\\uffff';\n            secondRequestOptions.startkey = '_design';\n        } else {\n            firstRequestOptions.endkey = '_design';\n            secondRequestOptions.startkey = '_design\\uffff';\n        }\n\n        let me = this;\n\n        return this.getDB(dbName).then( (db) => {\n            return db.allDocs(firstRequestOptions)\n            .then(function (results) {\n            \n                return db.allDocs(secondRequestOptions)\n                .then(function (endResults) {\n                    return [\n                        ...results.rows,\n                        ...endResults.rows\n                    ];\n            \n                }).catch(function (err) {\n                    log.error(err);\n                    return [];\n                });\n                \n            }).catch(function (err) {\n                log.error(err);\n                return [];\n            });\n        });\n    }\n\n    //gets a doc from a database\n    get(dbName, id) {\n\n        return this.getDB(dbName).then( (db) => {\n            return db.get(id, {})\n            .then(function (result) {\n                return result;\n            }).catch(function (err) {\n                log.error(err);\n                return {};\n            });\n        });\n    }\n\n    //query a view\n    view(dbName, viewName, startKey = '', endKey = '', group = false, descending = false, limit = 0) {\n\n        let options = {\n            start_key: startKey,\n            end_key: endKey,\n            group: group,\n            descending: descending\n        }\n\n        if (limit > 0) {\n            options.limit = limit;\n        }\n\n        return this.getDB(dbName).then( (db) => {\n            return db.query(\n                viewName,\n                options\n            )\n            .then(function (response) {\n                return response.rows;\n            })\n            .catch(function (err) {\n                log.error(err);\n                return [];\n            });\n        });\n    }\n\n    //replicate a local database to remote\n    replicate(db) {\n        let me = this;\n        return db.replicate.to(this.sharding.getRemoteUrl() + db.name)\n        .then( (result) => {\n            me.addSyncCheckpoint(db.name);\n            return new Promise( (resolve) => resolve() );\n        })\n        .catch( err => {\n            log.error(err);\n        });\n    }\n\n    //replicates all databases to remote\n    replicateAllDBs() {\n        let me = this;\n        let promises = [];\n\n        this.dbs.forEach(function (db, dbName) {\n            promises.push(me.replicate(db));\n        });\n\n        return Promise.all(promises);\n    }\n\n    //saves a doc in the database\n    save(dbName, doc) {\n\n        this.addUpdateCheckpoint(dbName);\n        \n        return this.getDB(dbName).then( (db) => {\n\n            let me = this;\n\n            return db.put(doc)\n            .then(function (response) {\n                //if the database is not replicated live, manually sync it now\n                if (!me.isLiveReplicate(dbName)) {\n                    return me.replicate(db)\n                    .then( (success) => {\n                        return response;\n                    });\n                }\n\n                return response;\n            })\n            .catch(function (err) {\n                me.handleUpdateError(db, doc, err);\n            });\n\n        });\n\n    }\n\n    //creates a doc in the database\n    create(dbName, doc) {\n\n        let me = this;\n        this.addUpdateCheckpoint(dbName);\n\n        return this.getDB(dbName).then( (db) => {\n            \n            let me = this;\n\n            return db.post(doc)\n            .then(function (response) {\n                       \n                //if the database is not replicated live, manually sync it now\n                if (!me.isLiveReplicate(dbName)) {\n                    return me.replicate(db)\n                    .then( (success) => {\n                        return response;\n                    });\n                }\n\n                return response;\n            })\n            .catch(function (err) {\n                me.handleUpdateError(db, doc, err);\n            });\n\n        });\n    }\n\n    //adds a pending sync check point \n    addUpdateCheckpoint(dbName) {\n        this.lastUpdates.set(dbName, Date.now());\n\n        //persist to storage in case user closes browser\n        this.persistMap(this.lastUpdates, 'last-updates');\n    }\n\n    //add a synced check point\n    addSyncCheckpoint(dbName) {\n        this.lastSyncs.set(dbName, Date.now());\n\n        //persist to storage in case user closes browser\n        this.persistMap(this.lastSyncs, 'last-syncs');\n    }\n\n    //removes a pending sync check point\n    removeUpdateCheckpoint(dbName) {\n        this.lastUpdates.delete(dbName);\n        this.persistMap(this.lastUpdates, 'last-updates');\n    }\n\n    //removes a synced check point\n    removeSyncCheckpoint(dbName) {\n        this.lastSyncs.delete(dbName);\n        this.persistMap(this.lastSyncs, 'last-syncs');\n    }\n\n    //persists a map to local storage\n    persistMap(map, name) {\n        let storage = [];\n        map.forEach( (value, key) => storage = [...storage, [key, value]] );\n        localStorage.setItem(name, JSON.stringify(storage));\n    }\n\n    //restores in-memoty sync check points from local storage\n    restoreCheckpoints() {\n        if (localStorage.getItem('last-updates') !== null) {\n            this.lastUpdates = new Map(JSON.parse(localStorage.getItem('last-updates')));\n        }\n        if (localStorage.getItem('last-syncs') !== null) {\n            this.lastSyncs = new Map(JSON.parse(localStorage.getItem('last-syncs')));\n        }\n    }\n\n    //returns true if some local changes haven't yet been synced with remote\n    hasUnsyncedUpdate() {\n\n        //no syncing on test env\n        if (environment.testing) {\n            return false;\n        }\n\n        let hasUnsynced = false;\n        let me = this;\n\n        this.lastUpdates.forEach(function (lastUpdate, dbName) {\n\n            if (\n                !me.lastSyncs.has(dbName) ||\n                me.lastUpdates.get(dbName) > me.lastSyncs.get(dbName)\n            ) {\n                hasUnsynced = true;\n            }\n\n        });\n\n        return hasUnsynced;  \n    }\n\n}","import { inject, singleton } from 'aurelia-framework';\nimport { Session} from './session';\nimport PouchDB from 'pouchdb';\nimport moment from 'moment';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { HttpClient } from 'aurelia-fetch-client';\nimport settings from '../config/app-settings';\n\n@inject(Session, HttpClient, EventAggregator)\n@singleton()\nexport class HTTPService {\n\n    constructor(session, http, ea) {\n        this.session = session;\n        this.http = http;\n        this.ea = ea;\n\n        this.configure();\n    }\n\n    configure() {\n        this.http.configure(config => {\n        config\n            .useStandardConfiguration()\n            .withBaseUrl(settings.baseUrl)\n            .withDefaults({\n            credentials: 'same-origin',\n            headers: {\n                'Accept': 'application/json',\n                'X-Requested-With': 'Fetch'\n            }\n            })\n            .withInterceptor({\n                request(request) {\n                    return request;\n                },\n                response(response) {\n                    return response;\n                },\n                responseError(response) {\n                    console.log(response);\n                    ea.publish(new FlashErrorMessage(i18n.tr(response.statusText)));\n                    return new Error(response.statusText);\n                }\n            })\n            .withInterceptor({\n                request(request) {\n                    let authHeader = fakeAuthService.getAuthHeaderValue(request.url);\n                    request.headers.append('Authorization', authHeader);\n                    return request;\n                }\n            })\n            ;\n        });\n    }\n\n    fetch(url) {\n         return this.http.fetch(url)\n        .then(response => response.json())\n        .then(users => {\n            return users;\n        })\n    }\n\n}","import {LogManager} from \"aurelia-framework\";\nexport var log = LogManager.getLogger('timesheet');","import { inject, singleton } from 'aurelia-framework';\nimport { Router } from 'aurelia-router';\nimport { AuthService } from 'aurelia-auth';\nimport {I18N} from 'aurelia-i18n';\nimport PouchDB from 'pouchdb';\n\nimport settings from '../config/app-settings';\nimport { log } from './log';\nimport { ShardingService } from './sharding-service';\n\n@singleton()\n@inject(Router, AuthService, ShardingService, I18N)\n\n/**\n * Service to handle session related information\n */\nexport class Session {\n\n    constructor(router, auth, sharding, i18n) {\n        this.router = router;\n        this.auth = auth;\n        this.sharding = sharding;\n        this.i18n = i18n;\n\n        this.loadFromStorage();\n        this.locale = this.getLocale();\n        this.i18n\n            .setLocale(this.locale);\n\n        this.started = false;\n    }\n    \n    start() {\n        let me = this;\n\n        //reload the user from remote if possible when the session start\n        //in case his info have changed\n        return this.loadUserFromBackend().then( () => {\n\n            me.started = true;\n            return new Promise((resolve) => { resolve(); });\n            \n        }).catch (function (err) {\n            log.error(err);\n        });\n    }\n\n    isStarted() {\n        return this.started;\n    }\n\n    loadFromStorage() {\n        if (localStorage.getItem('session') !== null) {\n            let session = JSON.parse(localStorage.getItem('session'));\n            this.user = session.user;\n            this.locale = session.locale;\n        }\n    }\n\n    persistToStorage() {\n        let session = {\n            'user': this.user,\n            'locale': this.locale\n        };\n\n        localStorage.setItem('session', JSON.stringify(session));\n    }\n\n    setUser(user) {\n        this.user = user;\n        this.persistToStorage();\n    }\n\n    getUser() {\n        return this.user;\n    }\n    \n    loadUserFromBackend() {\n\n        if (localStorage.getItem('aurelia_token') === null) {\n            return new Promise((resolve) => {});\n        }\n\n       let userInfo = atob(localStorage.getItem('aurelia_token')).split(':');\n       let username = userInfo[0];\n       let password = userInfo[1];\n\n        let db = new PouchDB(\n            this.sharding.getRemoteUrl() + '_users',\n            { \n                skipSetup: true,\n                auth: {\n                    \"username\": username,\n                    \"password\": password\n                },\n                ajax: {\n                    \"withCredentials\": false\n                }\n            }\n        );\n\n        let me = this;\n\n        return db.get(\n            'org.couchdb.user:' + username,\n            {\n                include_docs: true\n            }\n        ).then(function (result) {\n            me.user = result;\n            me.persistToStorage();\n            return result;\n        }).catch(function (err) {\n            //do nothing, session is returned from storage\n            log.error(err);\n        });\n       \n    }\n\n    invalidate() {\n        this.user = null;\n        localStorage.setItem('session', '{}');            \n        this.auth.logout('#/login');\n    }\n\n    getLocale() {\n\n        if (this.locale !== undefined) {\n            return this.locale;\n        }\n\n        if (this.user !== undefined && this.user.preferred_locale !== undefined) {\n            return this.user.preferred_locale;\n        }\n        \n        return settings.default_locale;\n    }\n\n    switchLocale(locale) {\n        this.locale = locale;\n        this.setBaseUrl();\n        this.i18n.setLocale(this.locale);\n\n        this.persistToStorage();\n        \n        this.router.navigate(this.router.history.fragment, {replace:true});\n    }\n\n    getToken() {\n        return localStorage.getItem('aurelia_token');\n    }\n\n    isGranted(role) {\n        if (this.user === undefined || this.user === null) {\n            return false;\n        }\n        return this.user.roles.includes(role);\n    }\n}","import { singleton } from 'aurelia-framework';\nimport settings from '../config/app-settings';\n\nconst MAX_CONNECTIONS = 6;\n\n@singleton(false)\n\n/**\n * Service to retrieve remote Url based on the list of domains\n * in the list in settings.\n * Allows to connect to the remote host using different domain names\n * in order to circumvent the browser's limitation of maximum number of open connections\n * to a remote host name\n */\nexport class ShardingService {\n    \n    curIndex = 0;\n    curConnections = 0;\n\n    getRemoteUrl() {\n\n        if (this.curConnections >= MAX_CONNECTIONS) {\n            this.curConnections = 0;\n            this.curIndex++;\n        }\n\n        //if we used all hosts, go back to the first one and cross fingers\n        if (this.curIndex === settings.remoteUrls.length) {\n            this.curIndex = 0;\n        }\n\n        this.curConnections++;\n        return settings.remoteUrls[this.curIndex];\n    }\n}","import {inject} from 'aurelia-dependency-injection';\nimport {ValidationRenderer, RenderInstruction, ValidateResult} from 'aurelia-validation';\n\n@inject(Element)\n\n/**\n * Form validation renderer for Semantic-UI forms \n */\nexport class SemanticFormValidationRenderer {\n\n    constructor(boundaryElement) {\n        this.boundaryElement = boundaryElement;\n    }\n\n    render(instruction) {\n        for (let { result, elements } of instruction.unrender) {\n            for (let element of elements) {\n                this.remove(element, result);\n            }\n        }\n\n        for (let { result, elements } of instruction.render) {\n            for (let element of elements) {\n                this.add(element, result);\n            }\n        }\n\n    }\n\n    add(target, result) {\n    \n        if (result.valid) {\n            return;\n        }\n\n        // tag the element so we know we rendered into it.\n        target.errors = (target.errors || new Map());\n        target.errors.set(result);\n\n        // add the error class to the semantic field\n        const field = target.querySelector('.field') || target.closest('.field');\n        field.classList.add('error');\n\n        // add help-block\n        const message = document.createElement('div');\n        message.classList.add('ui');\n        message.classList.add('error');\n        message.classList.add('message');\n        message.classList.add('visible');\n        message.classList.add('validation-error');\n        message.textContent = result.message;\n        message.error = result;\n        field.appendChild(message);\n        \n    }\n\n    remove(target, result) {\n\n        if (result.valid) {\n            return;\n        }\n\n        target.errors.delete(result);\n\n        // remove the has-error class on the bootstrap form-group div\n        const field = target.querySelector('.field') || target.closest('.field');\n        field.classList.remove('error');\n\n        // remove all messages related to the error.\n        let messages = field.querySelectorAll('.validation-error');\n        let i = messages.length;\n        while(i--) {\n            let message = messages[i];\n            if (message.error !== result) {\n                continue;\n            }\n            message.result = null;\n            message.remove();\n        }\n        \n    }\n}\n\n// Polyfill for Element.closest and Element.matches\n// https://github.com/jonathantneal/closest/\n(function (ELEMENT) {\n\tELEMENT.matches = ELEMENT.matches || ELEMENT.mozMatchesSelector || ELEMENT.msMatchesSelector || ELEMENT.oMatchesSelector || ELEMENT.webkitMatchesSelector;\n\n\tELEMENT.closest = ELEMENT.closest || function closest(selector) {\n\t\tvar element = this;\n\n\t\twhile (element) {\n\t\t\tif (element.matches(selector)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\telement = element.parentElement;\n\t\t}\n\n\t\treturn element;\n\t};\n}(Element.prototype));","import { inject } from 'aurelia-framework';\n\nexport class AdminPanel {\n\n    attached() {\n        $('.admin.panel.menu .item').tab({\n            'onLoad': function (tab, param) {\n                document.querySelector('admin-reports').au.controller.viewModel.refresh();\n            },\n        });\n    }\n\n    activate(params) {        \n        this.month = params.month;\n    }\n\n}","import { bindable } from 'aurelia-framework';\n\nexport class AdminReport {\n\n    @bindable entries;\n    @bindable totals;\n\n}","import { inject, bindable, TaskQueue } from 'aurelia-framework';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { AccountingService } from '../../services/accounting-service';\nimport moment from 'moment';\nimport { I18N } from 'aurelia-i18n';\nimport Decimal from 'decimal';\n\nimport { AdminRouter } from './admin-router';\nimport { DBService } from '../../services/db-service';\nimport settings from '../../config/app-settings';\nimport { log } from '../../services/log';\n\n@inject(DBService, AccountingService, I18N, EventAggregator, TaskQueue)\n\n/**\n * VM for accounting reports\n */\nexport class AdminReports {\n\n    //month for which the report is shown\n    @bindable month;\n\n    //map of all user names => user docs\n    users = new Map();\n\n    //maps allocation ids => names\n    allocations = new Map();\n\n    //reports for each user mapping username => accounting report\n    allocationUserReports = new Map();\n\n    //aggregate reports for each allocation\n    allocationReports = [];\n\n    //switch to see total monthly report or per user report\n    showMonthAggregate = false;\n\n    constructor(db, accounting, i18n, ea, taskQueue) {\n        this.db = db;\n        this.accounting = accounting;\n        this.i18n = i18n;\n        this.ea = ea;\n        this.taskQueue = taskQueue;\n    }\n\n    attached() {\n\n        let me = this;\n        $('#showMonthAggregate').checkbox({\n            onChange: function() {\n                me.showMonthAggregate = $('#showMonthAggregate').hasClass('checked');\n            }\n        });\n\n        this.loadReports();\n\n        //reload data if timesheet is synced from remote with new data\n        this.subscriber = this.ea.subscribe('dbsync', response => {\n            if (response.dbName.match(/^timesheet\\-/)) {\n                me.retrieveAllocationReports().then( () => {\n                    me.taskQueue.queueMicroTask(() => {\n                        me.generateUsersExportLinks();                                        \n                        me.aggregateReports();\n                    });\n                })\n            }\n        });\n\n    }\n\n    detached() {\n        this.subscriber.dispose();\n    }\n\n    refresh() {\n        this.loadReports();\n    }\n\n    //retrieves the representation the month after current one\n    getNextMonth() {\n\n        let monthArr = this.month.split('-');\n        if (parseInt(monthArr[1]) === 12) {\n            return (parseInt(monthArr[0]) + 1 ) + '-01';\n        }\n\n        let next = parseInt(monthArr[1]) + 1;\n\n        return monthArr[0] + '-' + (next<10?'0':'') + next;\n\n    }\n\n    loadReports() {\n        this.retrieveUsers()\n        .then( () => this.retrieveAllocations() )\n        .then( () => this.retrieveAllocationReports() )\n        .then( () => {\n            this.taskQueue.queueMicroTask(() => {\n                this.generateUsersExportLinks();                                        \n                this.aggregateReports();\n            });\n        });\n    }\n\n    retrieveUsers() {\n        let me = this;\n\n        return this.db.listUsers().then( response => {\n            response.forEach( (user) => {\n                me.users.set(user.doc.name, user);\n            });\n            return new Promise((resolve) => { resolve(); });\n        }); \n\n    }\n\n    retrieveAllocations() {\n        let me = this;\n        return this.db.list('allocation').then( response => {\n\n            if (response) {\n\n                response.forEach(function (allocation) {\n                    me.allocations.set(allocation.id, allocation.doc.name);\n                })               \n            \n            }\n\n            return new Promise((resolve) => { resolve(); });\n        });\n    }\n\n    /**\n     * Retrieve and calculate reports for each users\n     * Calculation is currently done in memory because only javascript views\n     * can be used on cloudant and they cannot be used to do floating point arithemtics.\n     * Ideally, an Erlang view can probably be used to do that\n     */\n    retrieveAllocationReports() {\n\n        let me = this;\n\n        let promises = [];\n        this.users.forEach(function (user) {\n\n            promises.push(\n                me.db.view(\n                    'timesheet-' + user.doc.name, \n                    'allocations/stats',\n                    me.month,\n                    me.getNextMonth(),\n                    false\n                ).then( entries => {\n\n                    if (entries === undefined) {\n                        return new Promise( (resolve) => resolve([]) );\n                    }\n\n                    let allocationUserReports = [];\n                    let reportsPromises = [];\n                \n                    return Promise.all(entries.map( (entry) => {\n\n                        let allocation = entry.key.split(':')[1];\n\n                        let report = {\n                            allocation: allocation,\n                            allocationName: me.allocations.get(allocation),\n                            ratio: new Decimal(parseFloat(entry.value[0])).mul(100),\n                            duration: new Decimal(entry.value[1]),\n                            salary: new Decimal(entry.value[2]).mul(parseFloat(entry.value[0])),\n                            precarite: entry.value[3]\n                        };\n\n                         return me.accounting.provisionAccounts(\n                            me.accountingRuleEndKey,\n                            report\n                        );\n\n                    }));\n\n                })\n                .then( allocationUserReports => {\n\n                    me.allocationUserReports.set(\n                        user.doc.name,\n                        me.groupReportsByAllocation(allocationUserReports)\n                    );\n                    \n                })\n\n            );\n        }); \n\n        return Promise.all(promises);\n    }\n\n    groupReportsByAllocation(reports) {\n\n        let totals = {};\n\n        let nbrReports = 0;\n\n        let grouped = new Map();\n        for (let reportIdx in reports) {\n\n            let report = Object.assign({}, reports[reportIdx]);\n            \n            if (!grouped.has(report.allocation)) {\n                \n                grouped.set(report.allocation, Object.assign({}, report));\n                totals = this.addReportsData(totals, report);\n                continue;\n            }\n\n            let current = grouped.get(report.allocation);\n\n            grouped.set(report.allocation, this.addReportsData(current, report));\n            totals = this.addReportsData(totals, report);\n\n        }\n\n        return {\n            entries: Array.from(grouped.values()),\n            totals: totals\n        };\n    }\n\n    //Adds Decimal properties from source to target and return the result\n    addReportsData(target, source) {\n\n        let result = {};\n\n        for (let prop of Object.getOwnPropertyNames(source)) {\n                        \n            if (typeof (source[prop]) === 'object') {\n                if (source[prop] instanceof Decimal) {\n                    result[prop] = new Decimal(0);\n                    if (target[prop] === undefined) {\n                        target[prop] = new Decimal(0);\n                    }\n                    result[prop] = target[prop].add(source[prop]);\n                }\n            }\n            \n        }\n\n        if (source.accounts !== undefined) {\n            result.accounts = {};\n            if (target.accounts === undefined) {\n                target.accounts = {};\n            }                    \n            result.accounts = this.addReportsData(target.accounts, source.accounts);\n        }\n\n        return result;\n    }\n\n    //aggregates all reports on allocation, regardless of user\n    aggregateReports() {\n\n        let allReports = [];\n        let nbrReports = 0;\n\n        for ( let allocationUserReportObjects of this.allocationUserReports.values() ) {            \n            allReports = [\n                ...allReports,\n                ...allocationUserReportObjects.entries\n            ];\n            nbrReports++;\n        }\n        this.allocationReports = this.groupReportsByAllocation(allReports);\n\n        //recalculate ratio based on number of reports\n        for (let entry of this.allocationReports.entries) {            \n            entry.ratio = entry.ratio.div(nbrReports);\n        }\n        if (this.allocationReports.totals.ratio !== undefined) {\n            this.allocationReports.totals.ratio = this.allocationReports.totals.ratio.div(nbrReports);\n        }\n        \n        this.generateExportLink();\n\n    }\n\n    //attach links to download reports as csv\n    generateUsersExportLinks() {\n\n        let me = this;\n        this.users.forEach( (user) => {\n            if (me.allocationUserReports.has(user.doc.name)) {\n                me.generateExportLink(user.doc.name);\n            }\n        });\n    }\n\n    generateExportLink(user = null) {\n\n        let me = this;\n        let csvContent = this.month + '\\n' +\n            this.i18n.tr('allocation') + ';' +\n            this.i18n.tr('ratio') + ';' +\n            this.i18n.tr('duration') + ';' +\n            this.i18n.tr('salary') + ';' +\n            this.i18n.tr('charges') + ';' +\n            this.i18n.tr('provisionCPbrut') + ';' +\n            this.i18n.tr('provisionCPcharges') + ';' +\n            this.i18n.tr('precaritebrut') + ';' +\n            this.i18n.tr('precaritecharges') +\n            '\\n'\n        ;\n\n        let reports = this.allocationReports;\n        let fileName = me.month + '.csv';\n        let lnk = document.getElementById('csv-export-link');\n        if (user !== null) {\n            reports = this.allocationUserReports.get(user);\n            fileName = user + \"-\" + me.month + '.csv';\n            lnk = document.getElementById(user + '-csv-export-link');\n        }\n\n        if (lnk === null || reports.entries.length === 0) {\n            return;\n        }\n\n        for (let reportIdx in reports.entries) {\n            let report = reports.entries[reportIdx];\n            csvContent += \n                report.allocationName + ';' + \n                report.ratio + ';' + \n                report.duration + ';' + \n                report.salary + ';' +\n                report.accounts.charges + ';' +\n                report.accounts.provisionCPBrut + ';' +\n                report.accounts.provisionCPCharges + ';' +\n                report.accounts.primePrecariteBrut + ';' +\n                report.accounts.primePrecariteCharges +\n                '\\n'\n            ;\n        };\n\n        csvContent += \n            ';' + \n            reports.totals.ratio + ';' + \n            reports.totals.duration + ';' + \n            reports.totals.salary + ';' +\n            reports.totals.accounts.charges + ';' +\n            reports.totals.accounts.provisionCPBrut + ';' +\n            reports.totals.accounts.provisionCPCharges + ';' +\n            reports.totals.accounts.primePrecariteBrut + ';' +\n            reports.totals.accounts.primePrecariteCharges +\n            '\\n' +\n            this.i18n.tr('netpayable') + ';' + reports.totals.accounts.netPayable + '\\n' +\n            this.i18n.tr('urssaf') + ';' + reports.totals.accounts.urssaf + '\\n' +\n            this.i18n.tr('provisionCPbrut') + ';' + reports.totals.accounts.provisionCP + '\\n' +\n            this.i18n.tr('provisionprecarite') + ';' + reports.totals.accounts.provisionPrecarite + '\\n'            \n        ;\n        \n        lnk.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(csvContent));\n        lnk.setAttribute('download', fileName);\n    }\n}","import { inject } from 'aurelia-framework';\nimport { Router } from 'aurelia-router';\nimport { I18N } from 'aurelia-i18n';\n\n@inject(Router, I18N)\nexport class AdminRouter {\n\n    constructor(router, i18n) {\n        this.router = router;\n        this.i18n = i18n;\n    }\n\n    configureRouter(config) {\n\n        config.map([\n            { \n                route: ['/', 'planning'],\n                name: 'planning',\n                moduleId: './planning',\n                nav: false,\n                title: this.i18n.tr('planning'),\n                auth: true\n            },\n            { \n                route: ':month',\n                name: 'panel',\n                moduleId: './admin-panel',\n                nav: false,\n                title: this.i18n.tr('budgetting'),\n                auth: true\n            }\n        ]);\n        \n    }\n\n    navigateToRoute(route, params) {\n       this.router.navigate(route);\n    }\n\n}","\nimport { inject } from 'aurelia-framework';\nimport moment from 'moment';\nimport { I18N } from 'aurelia-i18n';\n\nimport { AdminRouter } from './admin-router';\nimport settings from '../../config/app-settings';\n\n@inject(Element, AdminRouter)\nexport class Planning {\n\n    constructor(element, router) {\n        this.element = element;\n        this.router = router;\n    }\n\n    attached() {\n        let me = this;\n        $(this.element).find('.ui.calendar').calendar({\n            type: 'month',\n            inline: true,\n            text: settings.calendar_text,\n            onChange: function(date, text) {\n                let timesheetId = moment(date).format('YYYY-MM');\n                me.router.navigateToRoute('admin/' + timesheetId);\n            }\n        });\n    }\n}","\nimport { inject, NewInstance, bindable } from 'aurelia-framework';\nimport { I18N } from 'aurelia-i18n';\nimport { ValidationRules, ValidationController } from 'aurelia-validation';\nimport Decimal from 'decimal';\n\nimport { AdminRouter } from './admin-router';\nimport { DBService } from '../../services/db-service';\n\n@inject(DBService, I18N, NewInstance.of(ValidationController), AdminRouter)\n\n/**\n * VM for a single user timesheet\n */\nexport class UserTimesheet {\n\n    @bindable timesheet = {};\n    @bindable userName;\n    @bindable purposes = new Map();\n    @bindable unallocatedOnly;\n    @bindable accountingRules;\n    salary;\n\n    constructor(db, i18n, controller, router) {\n        this.db = db;\n        this.i18n = i18n;\n        this.controller = controller;\n        this.router = router;\n    }\n\n    attached() {\n\n        $('.' + this.userName + ' .precarite.checkbox').checkbox();\n        if (this.timesheet.precarite) {\n            $('.' + this.userName + ' .precarite.checkbox').checkbox('set checked');\n        }\n\n        ValidationRules\n            .ensure('salary').required()\n            .matches(/^[\\d]+[\\.|]?[\\d]*$/).withMessage(this.i18n.tr('error_number'))\n            .on(this.timesheet);\n\n    }\n\n    allocationSelected(dropdown) {\n        let userName = dropdown.element.dataset.username;\n\n        //manually update the entry as dropdown gets detached before this action (and addAction)\n        //arer called if using two way binding\n        this.timesheet.entries.forEach( (entry) => {\n            if (entry.id === dropdown.element.dataset.entryid) {\n                entry.allocation = dropdown.selectedEntry;\n            }\n        });\n\n        this.calculateRatios();\n\n        this.saveTimesheet(userName);\n    }\n\n    allocationAdded(dropdown) {\n        //add the newly added entry to all dropdowns on the page\n        $('.user.timesheet dropdown').each( function() {\n            this.au.controller.viewModel.entries = dropdown.entries;\n        });\n    }\n\n    calculateRatios() {\n\n        //calculate the ratio to apply to each entry based on the number of hours\n        let totalHours = 0;\n        this.timesheet.entries.forEach( (entry) => totalHours += entry.duration );\n        this.timesheet.entries.forEach( (entry) => {\n            entry.ratio = new Decimal(entry.duration).div(new Decimal(totalHours)).toJSON();\n        });\n\n    }\n\n    saveTimesheet(userName) {\n\n        let errors = this.controller.validate().then( result => {\n\n            if (!result.valid) {\n                return;\n            }\n\n            //manually update the timesheet as binding doesn't work with semantic checkbox\n            this.timesheet.precarite = $('.' + this.userName + ' .precarite.checkbox').checkbox('is checked');\n\n            //save and retrieve the latest revision of the timesheet for that user\n            this.db.save('timesheet-' + this.userName, this.timesheet).then( () => {\n                this.db.get('timesheet-' + this.userName, this.timesheet._id).then( (response) => {\n                    this.timesheet._rev = response._rev;\n                });\n            });\n\n        });\n    }\n\n    openEntry(id) {\n        this.router.navigateToRoute('timesheets/' + this.timesheet._id + '/' + id + '?r=admin/' + this.timesheet._id);\n    }\n}","\nimport { inject, NewInstance, bindable, observable } from 'aurelia-framework';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { DBService } from '../../services/db-service';\nimport settings from '../../config/app-settings';\nimport moment from 'moment';\nimport { log } from '../../services/log';\n\n@inject(DBService, EventAggregator)\n\n/**\n * VM for the list of timesheets that need to be allocated\n */\nexport class UsersTimesheets {\n\n    @bindable month;\n\n    timesheets = new Map();\n    users = new Map();\n    purposes = new Map();\n    unallocatedOnly = true;\n    \n    constructor(db, ea) {\n        this.db = db;\n        this.ea = ea;\n    }\n\n    attached() {\n\n        let me = this;\n        $('#showAll').checkbox({\n            onChange: function() {\n                me.unallocatedOnly = !$('#showAll').hasClass('checked');\n            }\n        });\n\n        this.retrieveData();\n\n        this.subscriber = this.ea.subscribe('dbsync', response => {\n            if (response.dbName.match(/^timesheet\\-/)) {\n                me.retrieveTimesheets();\n            }\n        });\n    }\n\n    detached() {\n        this.subscriber.dispose();\n    }\n\n    retrieveData() {\n        this.retrieveUsers()\n        .then( () => this.retrievePurposes() )\n        .then( () => this.retrieveTimesheets() );\n    }\n\n    retrieveUsers() {\n        let me = this;\n\n        return this.db.listUsers()\n        .then( response => {\n            response.map( (user) => {\n                me.users.set(user.doc.name, user);\n            });\n            return new Promise((resolve) => { resolve(); });\n        }); \n\n    }\n\n    retrievePurposes() {\n        let me = this;\n        return this.db.list('purpose')\n        .then( response => {\n            response.map( (purpose) => {\n                me.purposes.set(purpose.id, purpose.doc.name);\n            });\n\n            return new Promise((resolve) => { resolve(); });\n        });\n    }\n\n    retrieveTimesheets() {\n        let me = this;\n\n        this.users.forEach(function (user) {\n\n            me.db.get('timesheet-' + user.doc.name,  me.month).then( timesheet => {\n                if (timesheet) {\n                    me.timesheets.set(user.doc.name, timesheet);                                        \n                }\n            }); \n\n        }); \n    }\n}","\nimport { inject, bindable } from 'aurelia-framework';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { TimesheetsRouter } from './timesheets-router';\nimport { Session } from '../../services/session';\nimport { DBService } from '../../services/db-service';\nimport settings from '../../config/app-settings';\nimport moment from 'moment';\n\n@inject(Session, DBService, EventAggregator, TimesheetsRouter)\n\n/**\n * VM for the list of timesheet entries\n */\nexport class MonthlyTimesheet {\n\n    @bindable entity = {};\n    purposes = new Map();\n    interprets = new Map();\n\n    constructor(session, db, ea, router) {\n        this.session = session;\n        this.db = db;\n        this.ea = ea;\n        this.router = router;\n    }\n\n    activate(params) {        \n        this.timesheetId = params.id;\n    }\n\n    attached() {\n        this.retrieveData();\n\n        this.subscriber = this.ea.subscribe('dbsync', response => {\n            me.retrieveData();\n        });\n    }\n\n    detached() {\n        this.subscriber.dispose();\n    }\n\n    retrieveData() {\n        //first load purposes to show names in the list\n        this.listPurposes()\n        .then( () => this.listInterprets() )\n        .then( () => this.getTimesheet() );\n    }\n\n    listPurposes() {\n        let me = this;\n        return this.db.list('purpose').then( response => {\n            response.map( (purpose) => {\n                me.purposes.set(purpose.id, purpose.doc.name);\n            })               \n            \n            return new Promise((resolve) => { resolve(); });\n        });\n    }\n\n    listInterprets() {\n        let me = this;\n        return this.db.list('interpret')\n        .then( response => {\n\n            response.map( (interpret) => {\n                me.interprets.set(interpret.id, interpret.doc.name);\n            }) \n\n            return new Promise((resolve) => { resolve(); });\n        });\n    }\n    \n    getTimesheet() {\n        let me = this;\n\n        return this.db.get('timesheet-' + this.session.getUser().name,  this.timesheetId).then( response => {\n            me.entity = response;\n            return new Promise((resolve) => { resolve(); });\n        }); \n    }\n\n    openEntry(id) {\n        this.router.navigateToRoute('timesheets/' + this.entity._id + '/' + id + '?r=timesheets/' + this.entity._id);\n    }\n}","import { inject } from 'aurelia-framework';\n\nexport class PlanningRouter {\n\n   configureRouter(config, router) {\n\n        config.map([\n            { \n                route: ['/'],\n                name: 'planning',\n                moduleId: './planning',\n                nav: false,\n                title: 'Planning',\n                auth: true\n            },\n        ]);\n        this.router = router;\n    }\n\n    navigateToRoute(route, params) {\n       this.router.navigate(route);\n    }\n\n}","\nimport { inject, NewInstance, bindable, observable } from 'aurelia-framework';\nimport moment from 'moment';\n\nimport { TimesheetsRouter } from './timesheets-router';\nimport settings from '../../config/app-settings';\n\n@inject(Element, TimesheetsRouter)\nexport class Planning {\n\n    constructor(element, router) {\n        this.element = element;\n        this.router = router;\n    }\n\n    attached() {\n        let me = this;\n        $(this.element).find('.ui.calendar').calendar({\n            type: 'month',\n            inline: true,\n            text: settings.calendar_text,\n            onChange: function(date, text) {\n                let timesheetId = moment(date).format('YYYY-MM');\n                me.router.navigateToRoute('app/timesheets/' + timesheetId);\n            }\n        });\n    }\n}","\nimport { inject, NewInstance, bindable } from 'aurelia-framework';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { ValidationRules, ValidationController } from 'aurelia-validation';\nimport moment from 'moment';\nimport { I18N } from 'aurelia-i18n';\nimport { FlashSuccessMessage } from '../../resources/flash/flash-success-message';\n\nimport settings from '../../config/app-settings';\nimport { TimesheetsRouter } from './timesheets-router';\nimport { Session } from '../../services/session';\nimport { DBService } from '../../services/db-service';\n\n@inject(Element, Session, DBService, I18N, EventAggregator, TimesheetsRouter, NewInstance.of(ValidationController))\n\n/**\n * VM to edit or create a timesheet entry\n */\nexport class TimesheetEntry {\n\n    @bindable entity = {};\n\n    @bindable create = false;\n    @bindable saveAction;\n\n    constructor(element, session, db, i18n, ea, router, controller) {\n        this.element = element;\n        this.session = session;\n        this.db = db;\n        this.i18n = i18n;\n        this.ea = ea;\n        this.router = router;\n        this.controller = controller;\n    }\n\n    activate(params, routeConfig, navigationInstruction) {\n        if (params.timesheetId && params.entryId) {\n            this.getTimesheetEntry(params.timesheetId, params.entryId)\n        }\n\n        this.redirectTo = navigationInstruction.queryParams.r;\n    }\n\n    attached() {\n        \n        if ( ! this.entity.id ) {\n            this.entity.date = new Date();\n            this.entity.hours = 0;\n            this.entity.minutes = 0;\n            this.entity.interpret_hours = 0;\n            this.entity.interpret_minutes = 0;\n        }\n        this.setDate();\n        this.setupValidation();\n\n    }\n\n    setDate() {\n        let me = this;\n\n        $(this.element).find('.date.ui.calendar').each(function() {\n            $(this).calendar({\n                type: 'date',\n                formatInput: false,\n                text: settings.calendar_text\n            });\n\n            $(this).calendar(\n                'set date',\n                new Date(me.entity.date)\n            );\n        });        \n    }\n\n    get isEditable() {\n        return this.session.isGranted('admin') || \n            this.entity.allocation === undefined ||\n            this.entity.allocation === null\n        ;\n    }\n\n    setupValidation() {\n\n        ValidationRules.customRule(\n            'timeIsSet',\n            (value, obj) => parseInt(obj.minutes) > 0 || parseInt(value) > 0,\n            this.i18n.tr('time_not_set') \n        );\n\n        let me = this;\n        if (! this.create ) {\n            //An entry already created cannot be moved to a different month\n            ValidationRules.customRule(\n                'monthUnchanged',\n                (value, obj) => me.isMonthUnChanged()\n                ,\n                this.i18n.tr('month_changed') \n            );\n\n            ValidationRules\n                .ensure('dateInput').satisfiesRule('monthUnchanged')\n                .ensure('date').satisfiesRule('monthUnchanged')\n                .on(this);\n        }\n\n        ValidationRules\n            .ensure('date').required()      \n            .ensure('purpose').required()\n            .ensure('hours').required()\n                .matches(/^[\\d]+$/).withMessage(this.i18n.tr('error_number'))\n                .then()\n                .satisfiesRule('timeIsSet').when(entry => parseInt(entry.minutes) === 0)\n            .ensure('minutes').required().matches(/^[\\d]+$/).withMessage(this.i18n.tr('error_number'))\n            .ensure('interpret_hours').matches(/^[\\d]*$/).withMessage(this.i18n.tr('error_number'))\n            .ensure('interpret_minutes').matches(/^[\\d]*$/).withMessage(this.i18n.tr('error_number'))\n            .on(this.entity);\n    }\n\n    isMonthUnChanged() {\n        return this.entity.date === null || this.entity.date === undefined || \n            new Date(this.entity.date).getMonth() === \n            this.getCalendarDate().getMonth()\n        ;\n    }\n\n    getCalendarDate() {\n        return new Date($(this.element).find('.date.ui.calendar').calendar('get date'));\n    }\n\n    getTimesheetEntry(timesheetId, entryId) {\n        let me = this;\n\n        return this.db.get('timesheet-' + this.session.getUser().name,  timesheetId)\n        .then( response => {\n            response.map( (entry) => {            \n                if (entry.id === entryId) {\n                    me.entity = entry;\n                }\n            });\n\n            me.setDate();\n            return new Promise((resolve) => { resolve(); });\n        }); \n    }\n\n    doSave(event) {\n\n        let errors = this.controller.validate().then( result => {\n\n            //no error message, save button should not be available \n            if (!this.isEditable) {\n                return;\n            }\n            \n            if (!result.valid) {\n                return;\n            }\n\n            //manually edit as binding won't work with semantic calendar\n            this.entity.date = this.getCalendarDate();\n\n            if (this.create) {\n                this.entity.id = this.entity.purpose + ':' + Date.now();\n            }\n\n            this.entity.hours = parseInt(this.entity.hours);\n            this.entity.minutes = parseInt(this.entity.minutes);\n            this.entity.interpret_hours = parseInt(this.entity.interpret_hours);\n            this.entity.interpret_minutes = parseInt(this.entity.interpret_minutes);\n            this.entity.duration = this.entity.hours + parseFloat(this.entity.minutes/60);\n            this.entity.interpret_duration = this.entity.interpret_hours + parseFloat(this.entity.interpret_minutes/60);\n\n            let timesheetId = moment(this.entity.date).format('YYYY-MM');\n            \n            //get the timesheet document\n            this.db.get('timesheet-' + this.session.getUser().name, timesheetId).then( timesheet => {\n\n                if (! timesheet._id ) {\n                    timesheet = {\n                        _id: timesheetId,\n                        entries: []\n                    }\n                }\n                \n                //if entry already exists, remove it first\n                //traverese the array reverse to remove entries\n                let entry = this.entity;\n                timesheet.entries.slice().reverse().forEach(function(item, index, object) {\n                    if (item.id === entry.id) {\n                        timesheet.entries.splice(object.length - 1 - index, 1);\n                    }\n                });\n\n                timesheet.entries = [\n                    this.entity,\n                    ...timesheet.entries\n                ];\n\n                this.db.save('timesheet-' + this.session.getUser().name, timesheet).then( () =>\n                    this.ea.publish(new FlashSuccessMessage(this.i18n.tr('success')))\n                );\n            \n                if (this.create) {\n                    //reset entity for new entry\n                    this.entity = {\n                        purpose: this.entity.purpose,\n                        hours: 0,\n                        minutes: 0,\n                        interpret_hours: 0,\n                        interpret_minutes: 0\n                    };\n\n                    this.setupValidation();\n                }\n\n                if (this.saveAction) {\n                    this.saveAction({ entity: this.entity});\n                }\n\n                if (this.redirectTo) {\n                    this.router.navigateToRoute(this.redirectTo);\n                }\n            });\n            \n        });\n        \n    }\n}","import { inject } from 'aurelia-framework';\nimport { Router } from 'aurelia-router';\nimport { I18N } from 'aurelia-i18n';\n\n@inject(Router, I18N)\nexport class TimesheetsRouter {\n\n    constructor(router, i18n) {\n        this.router = router;\n        this.i18n = i18n;\n    }\n\n    configureRouter(config) {\n\n        config.map([\n            { \n                route: ['/'],\n                name: 'entry',\n                moduleId: './timesheets',\n                nav: false,\n                title: this.i18n.tr('timesheetentry'),\n                auth: true\n            },\n            { \n                route: [':id'],\n                name: 'timesheet',\n                moduleId: './monthly-timesheet',\n                nav: false,\n                title: this.i18n.tr('monthtimesheet'),\n                auth: true\n            },\n            { \n                route: ':timesheetId/:entryId',\n                name: 'timesheetEntry',\n                moduleId: './timesheet-entry',\n                nav: false,\n                title: this.i18n.tr('timesheetentry'),\n                auth: true\n            }\n        ]);\n        \n    }\n\n    navigateToRoute(route, params) {\n       this.router.navigate(route);\n    }\n\n}","import { inject, bindable } from 'aurelia-framework';\nimport { EventAggregator } from 'aurelia-event-aggregator';\n\nimport { Session } from '../../services/session';\nimport { DBService } from '../../services/db-service';\nimport { log } from '../../services/log';\n\n@inject(Session, DBService, EventAggregator)\n\n/**\n * VM to show new timesheet entry form and list of previous entries\n */\nexport class Timesheets {\n\n    purposes = new Map();\n    lastTimesheet = {\n        doc: {\n            entries: []\n        }\n    };\n    \n    constructor(session, db, ea) {\n        this.session = session;\n        this.db = db;\n        this.ea = ea;\n    }\n    \n    retrieveData() {\n        //first load purposes to show names in the list\n        this.listPurposes()\n        .then( () => this.getLastTimesheet() );\n    }\n\n    listPurposes() {\n        let me = this;\n        return this.db.list('purpose').then( response => {\n\n            response.map ( (purpose) => {\n                me.purposes.set(purpose.id, purpose.doc.name);\n            })\n\n            return new Promise((resolve) => { resolve(); });\n        });\n    }\n\n    getLastTimesheet() {\n        let me = this;\n\n        return this.db.list('timesheet-' + this.session.getUser().name, 1, true).then( response => {\n\n            me.lastTimesheet = {\n                doc: {\n                    entries: []\n                }\n            };\n            \n            if (response.length > 0) {\n                me.lastTimesheet = response[0];\n            }\n\n            return new Promise((resolve) => { resolve(); });\n        }); \n    }\n\n    attached() {\n        $('.ui.accordion')\n           .accordion({\n               exclusive: true\n           })\n        ;\n\n        this.retrieveData();\n\n        let me = this;\n        this.subscriber = this.ea.subscribe('dbsync', response => {\n            me.retrieveData();\n        });\n    }\n\n    detached() {\n        this.subscriber.dispose();\n    }\n\n    saveEntry(entry) {\n        //when an entry is saved, retrieve the last timesheet entries as they might have changed\n        this.getLastTimesheet();\n    }\n\n}","import { inject } from 'aurelia-framework';\nimport { Router } from 'aurelia-router';\n\nimport { Session } from '../../services/session'\nimport { log } from '../../services/log';\n\n@inject(Session, Router) \n\n/**\n * Landing after login to first start the session\n */\nexport class LoggedRedirect\n{\n    constructor(session, router) {\n        this.session = session;\n        this.router = router;\n    }\n\n    activate() {\n        let router = this.router;\n        this.session.start()\n        .then(() => {\n            router.navigate('app/timesheets');\n        })\n        .catch (function (err) {\n            log.error(err);\n        });\n    }\n}","import { inject } from 'aurelia-framework';\nimport { Router } from 'aurelia-router';\nimport PouchDB from 'pouchdb';\n\nimport PouchDBAuthentication from 'pouchdb-authentication';\nimport { log } from '../../services/log';\nimport { ShardingService } from '../../services/sharding-service';\n\n@inject(ShardingService, Router)\n\n/**\n * VM for login. Authenticates against remote database\n */\nexport class Login {\n\n    constructor(sharding, router){\n        this.sharding = sharding;\n        this.router = router;\n    };\n    \n    login() {\n\n        let me = this;\n        \n        PouchDB.plugin(PouchDBAuthentication);\n\n        let db = new PouchDB(this.sharding.getRemoteUrl() + '_users', { skipSetup: true });\n        db.login( this.username, this.password, function (err, response)  {\n\n            if (err) {\n                log.error(err);\n                me.loginError = err.name;\n                $('.ui.form .login.error.message').show();\n                return;\n            }\n\n            localStorage.setItem('aurelia_token', btoa(me.username + ':' + me.password));\n            me.router.navigate('loggedIn');\n        });\n    };\n\n}","import { inject, NewInstance, bindable, containerless } from 'aurelia-framework';\nimport { HttpClient, json } from 'aurelia-fetch-client';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport { ValidationRules, ValidationController } from 'aurelia-validation';\nimport { I18N } from 'aurelia-i18n';\nimport { UserRouter } from './user-router';\nimport { Session } from '../../services/session';\nimport settings from '../../config/app-settings';\nimport { FlashSuccessMessage } from '../../resources/flash/flash-success-message';\n\n@inject(Element, Session, I18N, HttpClient, UserRouter, EventAggregator, NewInstance.of(ValidationController))\nexport class Password {   \n\n    form = {};\n\n    constructor(element, session, i18n, http, router, ea, controller) {        \n        this.element = element;\n        this.session = session;\n        this.i18n = i18n;\n        this.http = http;\n        this.router = router;\n        this.ea = ea;\n        this.controller = controller;\n\n        this.form = {\n            current_password: null,\n            plain_password: {\n                first: null,\n                second: null\n            }\n        };\n    }\n    \n    activate() {\n\n        this.rules = ValidationRules\n            .ensure('current_password').required({ message: \"required\" })\n            .on(this.form)\n        ; \n\n        this.newrules = ValidationRules\n            .ensure('first').required().length({ minimum: 6 })\n            .ensure('second').required()\n            .ensure('first').equality('second')\n            .on(this.form.plain_password)\n        ;        \n    }\n\n    save(event) {\n\n        let errors = this.controller.validate();\n\n        if (errors.length > 0) {\n            return;\n        }\n\n        $(event.target).addClass('loading');\n\n        return this\n            .http.fetch(\n                'users/' + this.session.user.id + '/password',\n                {\n                    method: 'PUT',\n                    body: json(this.form)\n                }\n            )\n            .then(response => {\n                \n                $(event.target).removeClass('loading');\n\n                if (response instanceof Error) {\n                    Promise.reject(response);\n                    return response;\n                }\n\n                this.ea.publish(new FlashSuccessMessage(this.i18n.tr('success')));\n                this.form = {\n                    current_password: null,\n                    plain_password: {\n                        first: null,\n                        second: null\n                    }\n                };\n                return new Promise((resolve) => { resolve(); });\n            })\n            .catch( () => {} )\n        ;\n    }\n}\n\n","import { inject } from 'aurelia-framework';\n\nexport class UserRouter {\n\n   configureRouter(config, router) {\n\n        config.map([\n            { \n                route: ['/password'],\n                name: 'password',\n                moduleId: './password',\n                nav: true,\n                title: 'user:change_password',\n                settings: { 'icon': 'unlock' }\n            }\n        ]);\n        this.router = router;\n    }\n\n    navigateToRoute(route, params) {\n       this.router.navigate(route);\n    }\n\n}","import { inject } from 'aurelia-framework';\nimport { DialogController } from 'aurelia-dialog';\n\n@inject(DialogController)\nexport class Confirmation {\n\n    constructor(dialogController) {\n        this.dialogController = dialogController;\n    }\n\n    activate(data) {\n        this.message = data;\n    }\n}","import {bindable, inject} from 'aurelia-framework';\nimport {DialogService} from \"aurelia-dialog\";\nimport {Confirmation} from \"./confirmation\";\n\n@inject(DialogService)\nexport class DeleteButton extends BaseViewModel {\n\n    @bindable action=()=>{};\n\n    @bindable message = \"Are you sure ?\";\n\n    constructor(dialogService, ...rest) {\n        super(...rest);\n        this.dialogService = dialogService;\n        this.message = this.i18n.tr('delete_sure');\n    }\n\n    do($event) {\n        $event.stopPropagation();\n        this.dialogService.open({\n            viewModel: Confirmation,\n            model: this.message\n        }).then(result => {\n            if (result.wasCancelled) return;\n            this.action();\n        });\n    }\n\n}","\"use strict\";\n\nimport {inject, bindable, customAttribute} from 'aurelia-framework';\n\n@customAttribute( `ui-confirmation` )\n@inject( Element )\nexport class UIConfirmationAttribute {\n\n    @bindable approveCallback;\n\n    constructor( element ) {\n        alert(element);\n\t\tthis.element = element;\n\t}\n\n\tattached() {\n\t\t$( this.element ).modal({\n            onApprove: function(element) {\n                return function () {\n                    let confirmEvent = new CustomEvent('confirm', {\n                        detail: {\n                            value: 1\n                        },\n                        bubbles: true\n                    });\n                    element.dispatchEvent(confirmEvent);\n                }\n            }(this.element)\n        });\n\t}\n\n    activeChanged( newValue ) {\n\t\tif ( newValue ) {\n\t\t\t$( this.element ).modal( 'show' );\n\t\t} else {\n\t\t\t$( this.element ).modal( 'hide' );\n\t\t}\n\t}\n\n    bind($arg) {\n        this.approveCallback = $arg.approveCallback;\n    }    \n}","import { bindable, customElement, inject, TaskQueue } from 'aurelia-framework';\nimport { DBService } from '../../services/db-service';\nimport { EventAggregator } from 'aurelia-event-aggregator';\n\n@customElement('dropdown')\n@inject(Element, DBService, EventAggregator)\n\n/**\n * Dropdown custom element for SemanticUI\n * Loads data from backend. Bindings:\n * - selectedEntry : bind the selected key with parent element's attribute\n * - route: name of the database to load documents from\n * - name: name of the select element\n * - required: boolean\n * - multiple: boolean for multiple selects\n * - selectAction: action to call on parent element when an entry is selected\n * - addAction: action to call when a new entry is added\n */\nexport class DropDownCustomElement {\n\n    @bindable entries;\n    @bindable selectedEntry;\n    @bindable route;\n    @bindable name;\n    @bindable required = false;\n    @bindable multiple = false;\n    @bindable allowAdd = false;\n    @bindable selectAction = () => {};\n    @bindable addAction = () => {};\n    \n    selectedEntryName;\n\n    constructor(element, db, ea) {\n        this.element = element;\n        this.db = db;\n        this.ea = ea;\n    }\n\n    attached() {\n        let dropdown = this;\n        $(this.element).find('.ui.dropdown').dropdown({\n            'forceSelection': false,\n            'allowAdditions': dropdown.allowAdd,\n            'hideAdditions': !dropdown.allowAdd,\n            'onChange': function(value, text, $choice) {\n                if (\n                    typeof $choice !== 'undefined' &&\n                    $($choice[0]).hasClass('addition')\n                ) {\n                    dropdown.save(text);\n                } else {\n                    dropdown.selectedEntry = value;\n                }\n            }\n        });\n        this.load();\n\n        this.subscriber = this.ea.subscribe('dbsync', response => {\n            if (response.dbName === dropdown.route) {\n                dropdown.load();\n            }\n        });\n    }\n\n    detached() {\n        this.subscriber.dispose();\n    }\n\n    selectedEntryChanged() {\n\n        //leave if the entry is new as this will be re-triggered after the save operation\n        if (this.isSelectedEntryNew()) {\n            return;\n        }\n\n        let selected = $(this.element).find('.dropdown').dropdown('get value');\n\n        if (\n            selected[0] !== null && \n            (\n                this.selectedEntry === undefined || \n                this.selectedEntry === '' ||\n                this.selectedEntry === []\n            )\n        ) {\n            $(this.element).find('.dropdown').dropdown('clear');\n        }\n        this.setEntryName();\n\n        this.selectAction({ dropdown: this});\n\n    }\n\n    isSelectedEntryNew() {\n        if (this.entries === null) {\n            return true;\n        }\n\n        let me = this;\n        let isNew = true;\n        this.entries.forEach( (entry) => {\n            if (entry.id === me.selectedEntry) {\n                isNew = false;\n            }\n        });\n\n        return isNew;\n    }\n\n    restoreDefaults() {\n        $(this.element).find('.text')\n            .addClass('default');\n        this.selectedEntryName = this.getPlaceHolder();\n    }\n\n    getPlaceHolder() {\n        return $(this.element).find('.text').data('default');\n    }\n\n    setEntryName() {\n        if (this.multiple) {\n            return;\n        }\n\n        if (! this.entries) {\n            return;\n        }\n\n        for (let entry of this.entries) {\n            if (entry.id == this.selectedEntry) {\n                this.selectedEntryName = entry.doc.name;\n            }            \n        }\n\n        if (\n            this.selectedEntryName &&\n            this.selectedEntryName != this.getPlaceHolder()\n        ) {\n            $(this.element).find('.text')\n            .removeClass('default');\n        } else {\n            this.restoreDefaults();\n        }\n    }\n\n    load() {\n\n        this.db.list(this.route).then(\n            entries => {\n\n            this.entries = entries;\n\n            if (\n                this.entries &&\n                this.required &&\n                (this.selectedEntry === undefined || this.selectedEntry === '') &&\n                this.entries.length > 0\n            ) {\n                this.selectedEntry = this.entries[0].id;\n            }\n\n            this.setEntryName();\n        });\n                   \n    }\n\n    save(newEntry) {\n        let doc = {\n            name: newEntry\n        };\n        let me = this;\n\n        this.db.create(this.route, doc).then(\n            response => {\n                doc._id = response.id;\n                me.entries = [\n                    {id: response.id, doc : doc},\n                    ...me.entries\n                ];\n                me.selectedEntry = doc._id;\n                $(me.element).find('.dropdown').dropdown('set value', doc._id);\n                me.addAction({ dropdown: me });\n            }\n        )\n    }\n}","import { FlashMessage } from './flash-message';\n\nexport class FlashErrorMessage extends FlashMessage {\n    constructor(message) {\n        super(message);\n    }\n}","export class FlashMessage {\n    constructor(message) {\n        this.message = message;\n    }\n}","import { FlashMessage } from './flash-message';\n\nexport class FlashSuccessMessage extends FlashMessage {\n    constructor(message) {\n        super(message);\n    }\n}","import {bindable, inject} from 'aurelia-framework';\nimport { EventAggregator } from 'aurelia-event-aggregator';\nimport {CssAnimator} from 'aurelia-animator-css';\nimport { FlashMessage } from './flash-message';\nimport { FlashSuccessMessage } from './flash-success-message';\nimport { FlashErrorMessage } from './flash-error-message';\n\n@inject(Element, EventAggregator, CssAnimator)\n\n/**\n * Custom element for Flash Mesages, Animates the flash message\n */\nexport class Flash {\n    \n    message = '';\n\n    constructor(element, eventAggregator, cssAnimator) {\n        this.element = element;\n        this.ea = eventAggregator;\n        this.animator = cssAnimator;        \n    }\n\n    attached() {\n        let messageElement = this.element.querySelectorAll('.message')[0];\n        this.subscriber = this.ea.subscribe(\n            FlashMessage, event => {\n\n                this.message = event.message;\n\n                $(messageElement).removeClass('positive');\n                $(messageElement).removeClass('negative');\n                $(messageElement).removeClass('background-animation-add');\n                $(messageElement).removeClass('background-animation-remove');\n                \n                let flashType = 'positive';\n                if (event instanceof FlashErrorMessage) {\n                    flashType = 'negative';\n                } \n\n                window.scrollTo(0, 0);\n                this.animator.addClass(\n                    messageElement, \n                    flashType\n                )\n                .then(() => {\n                    this.animator.addClass(\n                        messageElement, \n                        'background-animation'\n                    )\n                    .then(() => {\n                        this.animator.removeClass(messageElement, 'background-animation');\n                        this.animator.removeClass(messageElement, flashType);\n                    });\n                })\n            }\n        );        \n    }\n\n    detached() {\n        this.subscriber.dispose();\n    }\n}","export class JoinValueConverter {\n    toView(value) {\n        if (\n            value === undefined ||\n            !Array.isArray(value)\n        ) {\n            return '';\n        }\n        return value.join(', ');\n    }\n}","import moment from 'moment';\n\nexport class DateFormatValueConverter {\n    toView(value) {    \n        return moment(value).format('D-MMM-YYYY');\n    }\n}","export class EmailValueConverter {\n    toView(value) {\n        let html = '';\n        if (\n            value === undefined ||\n            !Array.isArray(value)\n        ) {\n            return html;\n        }\n        value.forEach(function(mail) {\n            html += '<a href=\"mailto: ' + mail + '\">' + mail + '</a> '; \n        });\n    \n        return html;\n    }\n}","export class LimitToValueConverter {\n    toView(array, count) {\n        if (array == null || array === undefined) {\n            return [];\n        }\n        return array.slice(0, count);\n    }\n}","import moment from 'moment';\n\nexport class MonthFormatValueConverter {\n    toView(value) {    \n        return moment(value).format('MMMM YYYY');\n    }\n}","export class TelValueConverter {\n    toView(value) {\n        let html = '';\n        if (\n            value === undefined ||\n            !Array.isArray(value)\n        ) {\n            return html;\n        }\n        value.forEach(function(tel) {\n            html += '<a href=\"tel: ' + tel + '\">' + tel + '</a> '; \n        });\n    \n        return html;\n    }\n}","export class TruncateValueConverter {\n    toView(value, length) {\n        \n        if (value === null || value === undefined || value.length <= length) {\n            return value;\n        }\n        \n        return value.substring(0, length) + '...';\n    }\n}"],"sourceRoot":"../src"}